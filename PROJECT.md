# まちのカルテ（Machi no Karte）

## コンセプト
「自分の街を、ひと目でわかるように。」

自治体のオープンデータを、住民目線で使いやすく可視化するWebアプリ。
まず渋谷区で作り、ゆくゆくは全国どの自治体でも使える設計にする。

## ポジショニング
既存の「SHIBUYA CITY DASHBOARD」はPowerBIベースで17個のダッシュボードがバラバラ。
行政職員向けで、普通の住民には使いにくい。

このプロジェクトは：
- **住民目線**：引っ越し検討、子育て環境、街の安全性など「暮らしの判断」に使える
- **ひとつの画面**：バラバラのダッシュボードではなく、1ページで街の全体像がわかる
- **比較できる**：他の自治体と並べて見れる（23区比較、類似自治体比較）
- **拡張可能**：データソースを統一し、自治体名を変えるだけで全国対応

## 優先すべき価値
1. **使いやすさ** ＞ かっこよさ
2. **わかりやすさ** ＞ データ量
3. **拡張性** ＞ 渋谷区特化

---

## データソース

### メインデータ：e-Stat API（政府統計の総合窓口）
全国1,741市区町村の統一データ。これが拡張性の鍵。

- **API仕様**: https://www.e-stat.go.jp/api/api-info/e-stat-manual
- **利用登録が必要**（無料）：https://www.e-stat.go.jp/api/
- **政府統計コード**: `00200502`（社会・人口統計体系）
- **データセット**: 「統計でみる市区町村のすがた」2025年版が最新
- **渋谷区コード**: 都道府県=13（東京都）、市区町村=13113（渋谷区）

#### e-Statから取れる主要データ（表番号別）

**A. 人口・世帯**
- 総人口（男女別）
- 日本人人口 / 外国人人口
- 年齢別人口（15歳未満 / 15-64歳 / 65歳以上）
- 世帯数
- 核家族世帯数
- 65歳以上単独世帯数
- 婚姻件数 / 離婚件数

**B. 自然環境**
- 総面積
- 可住地面積

**C. 経済基盤**
- 課税対象所得
- 納税義務者数
- 事業所数（民営）
- 従業者数（民営）
- 製造品出荷額等
- 商業年間商品販売額

**D. 行政基盤**
- 歳入総額 / 歳出総額
- 地方税収入額
- 財政力指数
- 実質公債費比率
- 職員数

**E. 教育**
- 幼稚園数 / 小学校数 / 中学校数
- 幼稚園在園者数
- 小学校児童数 / 中学校生徒数
- 大学・短大数

**F. 労働**
- 労働力人口
- 完全失業者数

**G. 文化・スポーツ**
- 公民館数
- 図書館数
- 体育施設数

**H. 居住**
- 着工新設住宅戸数
- 住宅数

**I. 健康・医療**
- 一般病院数 / 一般診療所数
- 歯科診療所数
- 医師数 / 歯科医師数
- 病院病床数

**J. 福祉・社会保障**
- 介護老人福祉施設数
- 児童福祉施設等数
- 保育所等数
- 国民健康保険被保険者数

**K. 安全**
- 刑法犯認知件数
- 交通事故発生件数
- 火災発生件数
- 出火率

### サブデータ：渋谷区独自オープンデータ（渋谷区限定の深掘り用）
- **SHIBUYA OPEN DATA**: https://city-shibuya-data.opendata.arcgis.com/
- 町丁目別人口、施設位置、ハチ公バス利用者数など
- ※他自治体では使えない。渋谷区の「詳細モード」用

---

## 画面設計

### メイン画面：まちのカルテ（1ページ完結）

```
┌─────────────────────────────────────────┐
│ 🏥 まちのカルテ                          │
│ [渋谷区 ▼]  vs [港区 ▼]（比較モード）    │
├─────────────────────────────────────────┤
│                                         │
│  📊 まちのスコア（レーダーチャート）      │
│  暮らしやすさを6軸で可視化               │
│  ・子育て ・医療 ・安全                  │
│  ・経済  ・教育 ・住環境                 │
│                                         │
├─────────────────────────────────────────┤
│                                         │
│  📈 人口トレンド（折れ線グラフ）         │
│  人口推移 / 年齢構成の変化               │
│                                         │
├────────────┬────────────────────────────┤
│ 🏠 暮らし  │ 👶 子育て                   │
│ 世帯数     │ 保育所数                    │
│ 住宅着工   │ 児童福祉施設                │
│ 1人暮らし率│ 待機児童（あれば）          │
├────────────┼────────────────────────────┤
│ 🏥 医療    │ 🛡️ 安全                     │
│ 病院数     │ 犯罪件数                    │
│ 診療所数   │ 交通事故                    │
│ 医師数     │ 火災件数                    │
├────────────┼────────────────────────────┤
│ 💰 経済    │ 📚 教育                     │
│ 平均所得   │ 小中学校数                  │
│ 事業所数   │ 図書館数                    │
│ 財政力指数 │ 大学数                      │
└────────────┴────────────────────────────┘
```

### 各カードの設計方針
- **数字はデカく**、補足は小さく
- **全国平均・23区平均との比較**を必ず表示（↑↓矢印で上か下か一目瞭然）
- 数字の横に「これって多いの？少ないの？」がわかるゲージやランキング表示
- 専門用語は使わない（「財政力指数」→「自治体の財政の健全さ」など）

### 比較モード
- 自治体を2つ選んで横並び比較
- 23区ランキング表示（選択中の自治体をハイライト）

---

## 技術スタック

```
Vite + React + TypeScript
├── Recharts（グラフ）
├── Leaflet or Maplibre（地図 ※Phase2）
├── e-Stat API（メインデータ）
└── GitHub Pages でデプロイ
```

### なぜこの構成か
- Recharts: 軽量でReactネイティブ。D3より扱いやすい
- TypeScript: データの型が多いので安全性のため
- Leaflet: Phase2で町丁目マップを入れる時用
- GitHub Pages: 無料デプロイ。World Visual Dataと同じ運用

---

## 開発フェーズ

### Phase 1：MVP（まず動くもの）
- e-Stat APIからのデータ取得基盤
- 渋谷区の「まちのカルテ」1ページ表示
- 6カテゴリのカード（人口、子育て、医療、安全、経済、教育）
- レーダーチャート（まちのスコア）
- 全国平均・23区平均との比較表示

### Phase 2：比較と拡張
- 自治体セレクター（東京23区から選択）
- 2自治体の横並び比較
- 23区ランキング
- 年次推移グラフ

### Phase 3：全国対応＋深掘り
- 全国1,741自治体対応
- 類似自治体の自動提案（人口規模・面積が近い）
- 渋谷区限定：町丁目マップ（SHIBUYA OPEN DATAの独自データ活用）

---

## ファイル構成

```
machi-no-karte/
├── public/
├── src/
│   ├── App.tsx
│   ├── components/
│   │   ├── CitySelector.tsx      # 自治体選択
│   │   ├── ScoreRadar.tsx        # レーダーチャート
│   │   ├── StatCard.tsx          # 各指標カード（再利用）
│   │   ├── PopulationTrend.tsx   # 人口推移グラフ
│   │   ├── CompareView.tsx       # 比較モード
│   │   └── RankingBar.tsx        # 23区ランキング
│   ├── api/
│   │   ├── estat.ts              # e-Stat API呼び出し
│   │   └── types.ts              # データ型定義
│   ├── data/
│   │   ├── cityList.ts           # 自治体コード一覧
│   │   ├── indicators.ts         # 指標定義（名前、単位、カテゴリ）
│   │   └── averages.ts           # 全国・23区平均（プリコンパイル）
│   ├── hooks/
│   │   ├── useCityData.ts        # 自治体データ取得hook
│   │   └── useCompare.ts         # 比較用hook
│   ├── utils/
│   │   ├── score.ts              # スコア計算ロジック
│   │   └── format.ts             # 数値フォーマット
│   └── styles/
├── scripts/
│   └── prebuild-averages.ts      # 平均値の事前計算スクリプト
├── package.json
├── PROJECT.md
└── CLAUDE.md
```

---

## デザイン方針

- **ベース**: 白背景、落ち着いたグレー系。行政っぽくならないモダンさ
- **フォント**: Noto Sans JP（本文）+ 数値はタブラー数字対応のもの
- **カラー**: カテゴリごとに控えめなアクセントカラー
  - 人口: ブルー / 子育て: グリーン / 医療: レッド
  - 安全: オレンジ / 経済: パープル / 教育: ティール
- **レスポンシブ**: スマホで見ることを前提（住民が電車で見る）
- **アクセシビリティ**: 色だけに頼らない、テキスト補足あり

---

## e-Stat API 利用メモ

### 事前準備
1. https://www.e-stat.go.jp/mypage/user/preregister でユーザー登録
2. ログイン後 https://www.e-stat.go.jp/mypage/view/api でアプリケーションID発行
   - 名称: machi-no-karte
   - URL: http://test.localhost（ローカル開発なので仮でOK）
   - 「発行」ボタンでappIdが表示される
3. APIキーは環境変数 `VITE_ESTAT_API_KEY` で管理

### 主要エンドポイント
```
# 統計表一覧取得
GET https://api.e-stat.go.jp/rest/3.0/app/json/getStatsList
  ?appId={API_KEY}
  &statsCode=00200502

# 統計データ取得
GET https://api.e-stat.go.jp/rest/3.0/app/json/getStatsData
  ?appId={API_KEY}
  &statsDataId={TABLE_ID}
  &cdArea=13113          # 渋谷区
```

### 注意点
- APIは呼び出し回数制限あり（詳細は仕様確認）
- データはキャッシュすること（毎回APIを叩かない）
- 統計表IDは年度で変わる可能性あるので動的に取得推奨
- Phase1ではCSVダウンロードしてハードコードでもOK（API連携はPhase2）

---

## CC向け初期指示

最初のセッション:
```
PROJECT.mdを読んで、Phase 1のMVPを作ってください。
まずはVite + React + TypeScriptのセットアップから。
e-Stat APIは後回しで、渋谷区のデータをハードコードして
画面を先に作る方針で進めてください。
```

e-Statユーザー登録は自分で事前にやっておくこと:
https://www.e-stat.go.jp/mypage/user/preregister
→ ログイン後 https://www.e-stat.go.jp/mypage/view/api でappId発行
